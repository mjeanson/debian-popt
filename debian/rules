#!/usr/bin/make -f
#
# Created 5 January 1998 by Enrique Zanardi <ezanardi@ull.es>
# Rewritten for debhelper 1 Jul 1999 by Joseph Carter <knghtbrd@debian.org>
#
# Copying and modification is unlimited, provided that the modified
# version is marked as being modified.

export DH_COMPAT=2

PWD=$(shell pwd)

ifeq (DEB_BUILD_GNU_CPU,"alpha")
  LIBCDEV=libc6.1-dev
else
  LIBCDEV=libc6-dev
endif

build: build-stamp
build-stamp:
	dh_testdir

	./configure --prefix=/usr --mandir=/usr/share/man --enable-shared
	$(MAKE)

	touch build-stamp


clean:
	dh_testdir

	-$(MAKE) distclean

	dh_clean
	rm -rf $(PWD)/tmp
	rm -f build-stamp install-stamp

install: install-stamp
install-stamp:
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs -a

	$(MAKE) DESTDIR=$(PWD)/debian/tmp install

	mkdir $(PWD)/debian/tmp/lib
	mv $(PWD)/debian/tmp/usr/lib/libpopt.so.* $(PWD)/debian/tmp/lib/
	ln -sf /lib/libpopt.so.0 $(PWD)/debian/tmp/usr/lib/libpopt.so

	touch install-stamp


binary: binary-indep binary-arch

binary-indep:
# Nothing to see here

binary-arch: build install
	dh_testversion 2
	dh_testdir
	dh_testroot
	dh_installdocs -a
	dh_installchangelogs -a CHANGES
	dh_movefiles -a
	dh_strip -a
	dh_link -a
	dh_compress -a
	dh_fixperms -a
	dh_makeshlibs -a
	dh_installdeb -a
	dh_shlibdeps -a
	dh_gencontrol -a --dpkg-gencontrol-params="-Vlibcdev=$(LIBCDEV)"
	dh_md5sums -a
	dh_builddeb -a

.PHONY: binary-arch clean binary binary-indep binary-arch install
